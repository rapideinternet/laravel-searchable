<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Laravel Searchable by rapideinternet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Laravel Searchable</h1>
      <h2 class="project-tagline">Laravel search provider</h2>
      <a href="https://github.com/rapideinternet/laravel-searchable" class="btn">View on GitHub</a>
      <a href="https://github.com/rapideinternet/laravel-searchable/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/rapideinternet/laravel-searchable/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="laravel-searchable" class="anchor" href="#laravel-searchable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Laravel Searchable</h1>

<p>Makes models extending the SearchableModel class searchable by indexing them using two database tables and an extensive autmatically generated word list. It uses and improved version of the Metaphone phonetic algorithm, published by Lawrence Philips in 1990. The DoubleMetaphone method tries to account for spelling errors by generating two versions of the phonetic representation of the word.</p>

<h2>
<a id="example-model" class="anchor" href="#example-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example model</h2>

<div class="highlight highlight-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Searchable\Models\SearchableModel</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Item</span> <span class="pl-k">extends</span> <span class="pl-e">SearchableModel</span> {</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * The database table used by the model.</span></span>
<span class="pl-s1"><span class="pl-c">     *</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@var</span> string</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">protected</span> <span class="pl-smi">$table</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>items<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * The attributes that are mass assignable.</span></span>
<span class="pl-s1"><span class="pl-c">     *</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@var</span> array</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">protected</span> <span class="pl-smi">$fillable</span> <span class="pl-k">=</span> [ </span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>, </span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>content<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        ];</span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * The attributes that are automatically indexed and searchable.</span></span>
<span class="pl-s1"><span class="pl-c">     *</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@var</span> array</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">protected</span> <span class="pl-smi">$searchable</span> <span class="pl-k">=</span> [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">20</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>content<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">5</span>,</span>
<span class="pl-s1">        ];  </span>
<span class="pl-s1"></span>
<span class="pl-s1">}</span></pre></div>

<h2>
<a id="setting-up" class="anchor" href="#setting-up" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up</h2>

<p>Update <strong>composer.json</strong> with the following entries</p>

<pre><code>"require": {
    "rapideinternet/laravel-searchable": "dev-master"
},

"repositories": [
    {
        "type": "vcs",
        "url":  "git@github.com:rapideinternet/laravel-searchable.git"
    }
],
</code></pre>

<p>Update your <strong>config\app.php</strong></p>

<div class="highlight highlight-php"><pre><span class="pl-s1"><span class="pl-s"><span class="pl-pds">'</span>providers<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">    <span class="pl-k">...</span></span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>Searchable\SearchableServiceProvider<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">],</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-s"><span class="pl-pds">'</span>aliasses<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">    <span class="pl-k">...</span></span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>Search<span class="pl-pds">'</span></span>        <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Searchable\Facades\Search<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">],</span></pre></div>

<p>Run the following shell commands</p>

<pre><code>composer update
php artisan vendor:publish
php artisan migrate
</code></pre>

<p>Update your models by changing the following lines</p>

<div class="highlight highlight-php"><pre><span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Website</span> <span class="pl-k">extends</span> <span class="pl-e">Model</span> {</span></pre></div>

<p>To extend the SearchableModel class instead of the Model class</p>

<div class="highlight highlight-php"><pre><span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Website</span> <span class="pl-k">extends</span> <span class="pl-e">SearchableModel</span> {</span></pre></div>

<p>Add an array of searchable attributes. Each attribute carries a weight. More weight means higher relevance.</p>

<div class="highlight highlight-php"><pre><span class="pl-s1"><span class="pl-k">protected</span> <span class="pl-smi">$searchable</span> <span class="pl-k">=</span> [</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">20</span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>comments<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">5</span>,</span>
<span class="pl-s1">    <span class="pl-k">...</span></span>
<span class="pl-s1">];</span></pre></div>

<p>For example if searching for the word <strong>"John"</strong>, one item may contain 1 occurence of the query in the <strong>'name'</strong> attribute while another item contains 3 occurences of the query in the <strong>'comments'</strong> attribute.</p>

<p>The result would be that the first item has a score of 20 while the second item has a score of 15 and is ranked lower because the 'name' attirubte is more relevant.</p>

<h2>
<a id="indexing" class="anchor" href="#indexing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Indexing</h2>

<p>Every time a model is saved or stored, it will automatically index the words present in the searchable array. This method is opportunistic and requires you to add new models through the ORM.</p>

<h3>
<a id="artisan" class="anchor" href="#artisan" aria-hidden="true"><span class="octicon octicon-link"></span></a>Artisan</h3>

<p>If you already have data present in your database that you need to index. You can simply run the following command:</p>

<pre><code>php artisan searchable:index
</code></pre>

<h3>
<a id="scheduler" class="anchor" href="#scheduler" aria-hidden="true"><span class="octicon octicon-link"></span></a>Scheduler</h3>

<p>If you want to schedule this index you can add it to the Kernel like this.</p>

<div class="highlight highlight-php"><pre><span class="pl-s1"><span class="pl-k">protected</span> <span class="pl-smi">$commands</span> <span class="pl-k">=</span> [</span>
<span class="pl-s1">    <span class="pl-k">...</span></span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>Searchable\Console\Commands\IndexCommand<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">protected</span> <span class="pl-k">function</span> <span class="pl-en">schedule</span>(<span class="pl-c1">Schedule</span> <span class="pl-smi">$schedule</span>)</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">...</span></span>
<span class="pl-s1">    <span class="pl-smi">$schedule</span><span class="pl-k">-&gt;</span>command(<span class="pl-s"><span class="pl-pds">'</span>searchable:index<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>dailyAt(<span class="pl-s"><span class="pl-pds">'</span>4:00<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">}</span></pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/rapideinternet/laravel-searchable">Laravel Searchable</a> is maintained by <a href="https://github.com/rapideinternet">rapideinternet</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

